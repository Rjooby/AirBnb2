
<div class="content group">

  <section class="index-map">
  adfsdf
    <div id='map-one' class='map'> </div>

<script>
var map = L.mapbox.map('map-one', 'rjooby.kodi76mc');
var featureLayer = L.mapbox.featureLayer().addTo(map);
var geoJSON =
  {type: "FeatureCollection",
  features: []};
</script>

  </section>

  <section class="index-listings">
    <main class="index-listing-form">
      <form class="form-listing-search">
        <label for=""> Where?
        <input type="text" name="some_name" value="">
        </label>

        <label>When?</label>
        <input type="date" name="some_name" value="">
        to
        <input type="date" name="some_name" value="">
        <input type="submit" name="some_name" value="Take me away">
      </form>

    </main>
    <main class="index-listing-locations">
      <h4>Available locations</h4>
      <ul id='locations-list'>    </ul>
      <%console.log(locations)%>
      <% locations.each(function (location) { %>

        <script>

            geoJSON.features.push({
              type: 'Feature',
              geometry: {
                type: 'Point',
                coordinates: [
                <%=location.escape("longitude")%>,
                <%=location.escape("latitude")%>
                ]
              },
              properties: {
                title: '<%=location.escape("name") %>',
                description: '<%=location.escape("description")%>',
                id: '<%= location.id %>',
                'marker-size': 'large',
                'marker-color': '#00A1D6',
                'marker-symbol': 'campsite'
              }
            })

        </script>



      <% }); %>

      <script>

      featureLayer.setGeoJSON(geoJSON);


        var markerList = document.getElementById('locations-list');
        map.featureLayer.on('ready', function(e) {
          featureLayer.eachLayer(function(layer) {
            var $ul = $("ul#locations-list");
            var $li = $('<li>');
            var $a =  $('<a>');
            $a.attr("href", "#/locations/" + layer.feature.properties.id);
            $a.html(layer.feature.properties.title)
            $li.html($a);
            $li.on("mouseenter", function(event) {
              map.panTo(layer.getLatLng());
            })
            $ul.append($li);
          });
        });

      </script>

    </main>
  </section>
</div>
